apiVersion: v1
kind: ConfigMap
metadata:
  name: vault-config
  namespace: vault
data:
  vault.hcl: |
    # Vault Server Configuration

    storage "raft" {
      path = "/vault/data"

      retry_join {
        leader_api_addr = "http://vault-0.vault-internal:8200"
      }
      retry_join {
        leader_api_addr = "http://vault-1.vault-internal:8200"
      }
      retry_join {
        leader_api_addr = "http://vault-2.vault-internal:8200"
      }
    }

    listener "tcp" {
      address     = "0.0.0.0:8200"
      tls_disable = true  # TLS terminated at ingress
    }

    api_addr = "http://POD_IP:8200"
    cluster_addr = "http://POD_IP:8201"

    # Auto-unseal with AWS KMS (if using AWS)
    # seal "awskms" {
    #   region     = "us-east-1"
    #   kms_key_id = "YOUR_KMS_KEY_ID"
    # }

    ui = true

    log_level = "info"
